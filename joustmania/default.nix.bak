{ stdenv
, fetchFromGitHub
, python3
, psmoveapi
}:

python3.pkgs.buildPythonApplication rec {
  name = "joustmania";

  src = fetchFromGitHub {
    owner = "adangert";
    repo = "JoustMania";
    rev = "393fefcf7675a1b8b396a43450b9cbf9dc23a9e9";
    sha256 = "0my4r1la9vsl4d1c3x5ljp9a5ph3wpbw7k4lhhrhpg4vs06aa6w6";
  };

  propagatedBuildInputs = with python3.pkgs; [
    (toPythonModule psmoveapi)
  ];

  format = "other";

  buildPhase = "";

  installPhase = ''
    mkdir -p $out
    cp -prvd ./* $out/

    rm -fR $out/{joust.sh,webui.sh,testing,logo,conf,color_test,aptfiles,.github}

    mkdir $out/bin
    makeWrapper '${python3.interpreter}' $out/bin/piparty \
      --add-flags $out/piparty.py
  '';
}
